---
meta:
  title: Using IP Mobility with the Scaleway API
  description: This page explains how to use IP Mobility with Scaleway API
content:
  h1: Using IP Mobility with the Scaleway API
  paragraph: This page explains how to use IP Mobility with Scaleway API
tags: ip mobility cloud scaleway-api migration ip-mobility
dates:
  validation: 2023-05-17
  posted: 2023-05-17
categories:
  - compute
---

## IP Mobility - Overview
When an Instance is started, it is assigned a private IP address that is associated with the underlying node hosting the Instance.
Consequently, if the underlying node changes, the private IP address will also change. This occurs, for exaple, when you stop and restart your Instance.
The private network allows Instances to communicate with each other through the `vrf-cp` (virtual routing and forwarding (VRF)).
It is worth noting that even if you don't assign a public IP to your Instance, you can still utilize this private IP to connect with other Instances.
Additionally, the public network is facilitated by a network component managing a carrier-grade NAT, which establishes a one-to-one mapping between the public IP and the private IP assigned to the Instance during provisioning.

With IP Mobility, there are no private IPs anymore. The public IP is entirely routed to the Instance. The main benefit is that your underlying IP do not change anymore whenever you stop and start your Instance or it gets provisioned on another hypervisor. But this also means that if you do not attach any public IP to your Instance, then it will not have any network access.

One additional feature is the option to assign multiple public IP addresses to your Instance, allowing you to select either IPv4 or IPv6 protocols.

## How to enable IP Mobility?

<Message type="note">
  Currently, IP Mobility is disabled by default. If you're interested in exploring its functionality, you need to explicitly request it.
</Message>

In this section, we will guide you through the process of creating a new IP Mobility-enabled instance. We will also provide instructions on migrating your existing legacy instances, keeping in mind that once the migration is complete, there is **no way to revert back**.

</Message type="tip"
 * The following examples rely on [httpie](https://httpie.io/cli), you can easily adapt them with curl if you prefer.
 * The `API_URL` variable contains the following value: https://api.scaleway.com/instance/v1/zones/pl-waw-2
 * The `HEADERS` variable contains: `X-Auth-Token :<API secret key>`
</Message>

## Create an IP Mobility IP

You can request IP Mobility compatible IP addresses using the Scaleway API. Available IP types are IPv4 and IPv6.

* Request:
    ```json
    ❯ cat payloads/srr/ip-data.json
    {
        "type": "routed_ipv4",
        "project": "7ddae24a-ad61-4744-830c-079d1c66abe1"
    }

    ❯ http post $API_URL/ips $HEADERS <payloads/srr/ip-data.json
    ```
    <Message type="tip">
      If you want an IPv6 address instead, replace the type `routed_ipv4` with `routed_ipv6`.
    </Message>
* Response:
    ```json
    {
        "ip": {
            "address": "51.158.51.51",
            "id": "01ac2664-699e-46b5-80be-9d43d477857f",
            "organization": "7ddae24a-ad61-4744-830c-079d1c66abe1",
            "prefix": null,
            "project": "7ddae24a-ad61-4744-830c-079d1c66abe1",
            "reverse": null,
            "server": null,
            "state": "detached",
            "tags": [],
            "type": "routed_ipv4",
            "zone": "pl-waw-3"
        }
    }
    ```
### Create a new Instance with IP Mobility

Run the following command to create an Instance with the previously created IP address.

* Request
    ```json
    ❯ cat payloads/srr/server-data.json
    {
        "name": "my-ipmobility-instance",
        "commercial_type": "GP1-S",
        "dynamic_ip_required": false,
        "dynamic_ipv6_required": false,
        "enable_ipv6": false,
        "routed_ip_enabled": true,
        "organization": "7ddae24a-ad61-4744-830c-079d1c66abe1",
        "public_ip": "01ac2664-699e-46b5-80be-9d43d477857f",
        "image": "2ce9f352-eed5-44e0-8bc2-a795f74aeb7a"
    }

    ❯ http post $API_URL/servers $HEADERS <payloads/srr/server-data.json
    ```
    <Message type="tip">
      In order to create a IP Mobility enabled Instance you have to add `"routed_ip_enabled": true` to your payload.
    </Message>

* Response
    ```json
    {
        "server": {
            "allowed_actions": [
                "poweron",
                "backup"
            ],
            "arch": "x86_64",
            "boot_type": "local",
            "bootscript": {
                "architecture": "x86_64",
                "bootcmdargs": "LINUX_COMMON scaleway boot=local nbd.max_part=16",
                "default": true,
                "dtb": "",
                "id": "9246a9bb-896c-464c-b6bd-b7443cd72c23",
                "initrd": "http://10.195.3.9/initrd/initrd-Linux-x86_64-v3.14.6.gz",
                "kernel": "http://10.195.3.9/kernel/x86_64-mainline-lts-4.4-4.4.182-rev1/vmlinuz-4.4.182",
                "organization": "11111111-1111-4111-8111-111111111111",
                "project": "11111111-1111-4111-8111-111111111111",
                "public": true,
                "title": "x86_64 mainline 4.4.182 rev1",
                "zone": "pl-waw-3"
            },
            "commercial_type": "GP1-S",
            "creation_date": "2023-02-05T21:30:31.779606+00:00",
            "dynamic_ip_required": false,
            "dynamic_ipv6_required": false,
            "enable_ipv6": false,
            "extra_networks": [],
            "hostname": "my-ipmobility-instance",
            "id": "7981f24a-1760-41b4-81ba-ec5d3868ccb4",
            "image": {
                "arch": "x86_64",
                "creation_date": "2022-11-17T16:50:34.380145+00:00",
                "default_bootscript": null,
                "extra_volumes": {},
                "from_server": null,
                "id": "eb40f656-1923-49b6-bb1d-53fe3a7329a0",
                "modification_date": "2022-11-17T16:50:34.380145+00:00",
                "name": "Ubuntu 22.04 Jammy Jellyfish",
                "organization": "7ddae24a-ad61-4744-830c-079d1c66abe1",
                "project": "7ddae24a-ad61-4744-830c-079d1c66abe1",
                "public": true,
                "root_volume": {
                    "id": "ccc917ca-8250-4b7b-89a9-614f08b17826",
                    "name": "Ubuntu 22.04 Jammy Jellyfish",
                    "size": 10000000000,
                    "volume_type": "unified"
                },
                "state": "available",
                "tags": [],
                "zone": "pl-waw-3"
            },
            "ipv6": null,
            "location": null,
            "mac_address": "de:00:00:01:c2:37",
            "maintenances": [],
            "modification_date": "2023-02-05T21:30:31.779606+00:00",
            "name": "my-ipmobility-instance",
            "organization": "7ddae24a-ad61-4744-830c-079d1c66abe1",
            "placement_group": null,
            "private_ip": null,
            "private_nics": [],
            "project": "7ddae24a-ad61-4744-830c-079d1c66abe1",
            "protected": false,
            "public_ip": {
                "address": "51.158.52.52",
                "dynamic": false,
                "family": "inet",
                "gateway": null,
                "id": "92873598-d8e6-4d98-9254-697b3e56ff6b",
                "netmask": "32",
                "provisioning_mode": "dhcp"
            },
            "public_ips": [
                {
                    "address": "51.158.52.52",
                    "dynamic": false,
                    "family": "inet",
                    "gateway": null,
                    "id": "92873598-d8e6-4d98-9254-697b3e56ff6b",
                    "netmask": "32",
                    "provisioning_mode": "dhcp"
                }
            ],
            "routed_ip_enabled": true,
            "security_group": {
                "id": "f4627d3b-d6f7-499d-924d-9bee71d191fa",
                "name": "Default security group"
            },
            "state": "stopped",
            "state_detail": "",
            "tags": [],
            "volumes": {
                "0": {
                    "boot": false,
                    "creation_date": "2023-02-05T21:30:31.779606+00:00",
                    "export_uri": null,
                    "id": "7981f24a-1760-41b4-81ba-ec5d3868ccb4",
                    "modification_date": "2023-02-05T21:30:31.779606+00:00",
                    "name": "Ubuntu 22.04 Jammy Jellyfish",
                    "organization": "7ddae24a-ad61-4744-830c-079d1c66abe1",
                    "project": "7ddae24a-ad61-4744-830c-079d1c66abe1",
                    "server": {
                        "id": "c7f2eb0f-7537-43b1-be95-736087f81b54",
                        "name": "my-ipmobility-instance"
                    },
                    "size": 300000000000,
                    "state": "available",
                    "tags": [],
                    "volume_type": "l_ssd",
                    "zone": "pl-waw-3"
                }
            },
            "zone": "pl-waw-3"
        }
    }
    ```

## Migrating existing Instances to IP Mobility

You can use a specific server action to migrate an existing (legacy network) Instance to IP Mobility.

* Request:
    ```json
    ❯ cat payloads/srr/migrate-data.json
    {
                "action": "enable_routed_ip"
    }

    ❯ http post $API_URL/servers/$SERVER_ID/action $HEADERS <payload/srr/migrate-data.json
    ```
    <Message type="note">
      You have to reboot your Instance have to complete the migration.
    </Message>

* Response
    ```json
    {
        "task": {
            "description": "server_enable_routed_ip",
            "href_from": "/servers/534c2d3c-5ce2-49dd-b82e-77f6e4eb0587/action",
            "href_result": "/servers/534c2d3c-5ce2-49dd-b82e-77f6e4eb0587",
            "id": "879f8362-2ee7-4aac-8df4-9a6cd9fdf7c5",
            "started_at": "2023-05-16T15:57:39.793534+00:00",
            "status": "pending",
            "terminated_at": null
        }
    }
    ```